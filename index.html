<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rajin Scan - Bibliothèque de Scans Privés</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* === Ton CSS reste inchangé === */
    /* ... Ton CSS déjà fourni ... */
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Rajin Scan</h1>
      <p class="tagline">Votre bibliothèque de scans privés</p>
    </header>

    <nav>
      <ul class="nav-tabs">
        <li><a href="#mes-scans" class="nav-link active">Mes Scans</a></li>
        <li><a href="#upload" class="nav-link">Uploader</a></li>
        <li><a href="#statistiques" class="nav-link">Statistiques</a></li>
        <li><a href="#parametres" class="nav-link">Paramètres</a></li>
      </ul>
    </nav>

    <!-- === Sections (ton code inchangé) === -->
    <section id="mes-scans" class="content-section active"> ... </section>
    <section id="upload" class="content-section"> ... </section>
    <section id="statistiques" class="content-section"> ... </section>
    <section id="parametres" class="content-section"> ... </section>
  </div>

  <!-- Notifications -->
  <div id="notification" class="notification"></div>

  <script>
    // ===============================
    // RAJIN SCAN APP - Frontend Logic
    // ===============================

    // --- Global State ---
    let scans = JSON.parse(localStorage.getItem("scans")) || [];
    let adminKey = localStorage.getItem("adminKey") || "admin123";
    let isAuthenticated = false;

    // --- DOM Elements ---
    const navLinks = document.querySelectorAll(".nav-link");
    const sections = document.querySelectorAll(".content-section");
    const scansList = document.getElementById("scansList");
    const totalScans = document.getElementById("totalScans");
    const pdfCount = document.getElementById("pdfCount");
    const imageCount = document.getElementById("imageCount");
    const storageUsed = document.getElementById("storageUsed");
    const recentActivity = document.getElementById("recentActivity");

    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const authStatus = document.getElementById("authStatus");
    const authForm = document.getElementById("authForm");
    const adminPanel = document.getElementById("adminPanel");

    const uploadBtn = document.getElementById("uploadBtn");
    const fileInput = document.getElementById("file");
    const fileName = document.getElementById("fileName");
    const titleInput = document.getElementById("title");
    const descInput = document.getElementById("description");

    const changeKeyBtn = document.getElementById("changeKeyBtn");
    const exportDataBtn = document.getElementById("exportDataBtn");

    const notification = document.getElementById("notification");

    // --- Navigation Tabs ---
    navLinks.forEach(link => {
      link.addEventListener("click", e => {
        e.preventDefault();
        navLinks.forEach(l => l.classList.remove("active"));
        sections.forEach(s => s.classList.remove("active"));
        link.classList.add("active");
        document.querySelector(link.getAttribute("href")).classList.add("active");
      });
    });

    // --- Authentification ---
    loginBtn.addEventListener("click", () => {
      const key = document.getElementById("adminKey").value.trim();
      if (key === adminKey) {
        isAuthenticated = true;
        authStatus.classList.remove("not-authenticated");
        authStatus.classList.add("authenticated");
        authStatus.innerHTML = `<i class="fas fa-unlock"></i> Connecté`;
        authForm.classList.add("hidden");
        adminPanel.classList.remove("hidden");
        showNotification("Connexion réussie", "success");
      } else {
        showNotification("Clé invalide", "error");
      }
    });

    logoutBtn.addEventListener("click", () => {
      isAuthenticated = false;
      authStatus.classList.add("not-authenticated");
      authStatus.classList.remove("authenticated");
      authStatus.innerHTML = `<i class="fas fa-lock"></i> Accès non autorisé - Veuillez vous identifier`;
      authForm.classList.remove("hidden");
      adminPanel.classList.add("hidden");
      showNotification("Session fermée", "warning");
    });

    // --- Upload ---
    fileInput.addEventListener("change", () => {
      fileName.textContent = fileInput.files[0]?.name || "Aucun fichier sélectionné";
    });

    uploadBtn.addEventListener("click", () => {
      if (!isAuthenticated) {
        return showNotification("Veuillez vous connecter", "error");
      }

      const file = fileInput.files[0];
      if (!file || !titleInput.value.trim()) {
        return showNotification("Titre et fichier requis", "error");
      }

      const type = file.type.includes("pdf") ? "pdf" : "image";
      const newScan = {
        id: Date.now(),
        title: titleInput.value.trim(),
        description: descInput.value.trim(),
        type,
        size: (file.size / (1024*1024)).toFixed(2), // MB
        date: new Date().toLocaleString(),
        fileName: file.name
      };

      scans.push(newScan);
      localStorage.setItem("scans", JSON.stringify(scans));
      renderScans();
      updateStats();
      addActivity(`Ajouté : ${newScan.title}`);

      // Reset form
      titleInput.value = "";
      descInput.value = "";
      fileInput.value = "";
      fileName.textContent = "Aucun fichier sélectionné";

      showNotification("Scan uploadé avec succès", "success");
    });

    // --- Rendu Scans ---
    function renderScans() {
      if (scans.length === 0) {
        scansList.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-folder-open"></i>
            <p>Aucun scan disponible</p>
          </div>`;
        return;
      }

      scansList.innerHTML = scans.map(scan => `
        <div class="scan-card">
          <div class="scan-thumbnail">
            ${scan.type === "pdf" 
              ? `<i class="fas fa-file-pdf pdf-placeholder"></i>` 
              : `<img src="https://via.placeholder.com/400x200?text=${scan.title}" alt="${scan.title}">`}
          </div>
          <div class="scan-info">
            <div class="scan-title">${scan.title}</div>
            <div class="scan-meta">
              <span>${scan.type.toUpperCase()}</span>
              <span>${scan.size} MB</span>
            </div>
            <div class="scan-actions">
              <button onclick="viewScan(${scan.id})"><i class="fas fa-eye"></i> Voir</button>
              <button class="btn-danger" onclick="deleteScan(${scan.id})"><i class="fas fa-trash"></i> Suppr.</button>
            </div>
          </div>
        </div>
      `).join("");
    }

    // --- Stats ---
    function updateStats() {
      totalScans.textContent = scans.length;
      pdfCount.textContent = scans.filter(s => s.type === "pdf").length;
      imageCount.textContent = scans.filter(s => s.type === "image").length;
      storageUsed.textContent = scans.reduce((a, s) => a + parseFloat(s.size), 0).toFixed(2) + " MB";
    }

    // --- Activité ---
    function addActivity(msg) {
      const log = document.createElement("p");
      log.textContent = `- ${msg}`;
      recentActivity.appendChild(log);
    }

    // --- Actions Scans ---
    window.viewScan = id => {
      const scan = scans.find(s => s.id === id);
      alert(`Prévisualisation: ${scan.title}\nType: ${scan.type}\nTaille: ${scan.size}MB`);
    };

    window.deleteScan = id => {
      scans = scans.filter(s => s.id !== id);
      localStorage.setItem("scans", JSON.stringify(scans));
      renderScans();
      updateStats();
      addActivity(`Supprimé : ${id}`);
      showNotification("Scan supprimé", "warning");
    };

    // --- Paramètres ---
    changeKeyBtn.addEventListener("click", () => {
      const newKey = document.getElementById("adminKeyChange").value.trim();
      if (newKey.length < 6) {
        return showNotification("Clé trop courte", "error");
      }
      adminKey = newKey;
      localStorage.setItem("adminKey", adminKey);
      showNotification("Clé mise à jour", "success");
    });

    exportDataBtn.addEventListener("click", () => {
      const blob = new Blob([JSON.stringify(scans, null, 2)], {type: "application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "rajinscan_export.json";
      a.click();
      showNotification("Export effectué", "success");
    });

    // --- Notifications ---
    function showNotification(msg, type="success") {
      notification.textContent = msg;
      notification.className = `notification show ${type}`;
      setTimeout(() => {
        notification.classList.remove("show");
      }, 3000);
    }

    // --- Init ---
    renderScans();
    updateStats();
  </script>
</body>
</html>
